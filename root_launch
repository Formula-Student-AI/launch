#!/bin/bash
set -e

<<<<<<< HEAD
=======
mkdir /home/bristol-fsai/logs 2&>1

# Enable NVIDIA driver
>>>>>>> abf5556c122ffc12f19919ccf4cb8484e2979829
echo "----------------------"

echo "Ensuring permissions and folders are setup"
mkdir /home/bristol-fsai/logs 2&>1
sudo chmod +x /home/bristol-fsai/launch/can_launch
sudo chmod +x /home/bristol-fsai/launch/user_launch
sudo chmod +x /home/bristol-fsai/launch/ros1_launch
sudo chmod +x /home/bristol-fsai/launch/ros2_launch

# Enable NVIDIA driver
echo "Enabling NVIDIA drivers"
sudo prime-select nvidia
sudo modprobe nvidia
echo "Enabled NVIDIA drivers"

# Enable CAN modules
echo "Enabling can modules"
sudo modprobe can_dev
echo "Enabled can dev"
sudo modprobe can
echo "Enabled can"
sudo modprobe can_raw
echo "Enabled can raw"
sudo modprobe vcan
echo "Enabled vcan"

# Setup CAN link
sudo /home/bristol-fsai/launch/can_launch &

# Launch user commands
echo "Launching user commands"
su - bristol-fsai -c /home/bristol-fsai/launch/user_launch

